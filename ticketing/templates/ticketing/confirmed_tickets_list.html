{% extends 'ticketing/base.html' %}
{% block content %}
<h2>Confirmed Tickets</h2>

<form method="get" class="d-flex mb-3" role="search">
  <input 
    type="text" 
    name="q" 
    placeholder="Search by name, SRN, PRN or organiser" 
    value="{{ query }}" 
    class="form-control me-2 w-5"
    aria-label="Search"
  >
  <button type="submit" class="btn btn-primary">Search</button>
</form>

 <button id="downloadPdfBtn" class="btn btn-danger btn-sm download-btn">Download PDF</button>

<table class="table table-striped table-bordered table-hover confirmed-tickets-table">
  <thead class="table-primary">
    <tr>
      <th>Student Name</th>
      <th>SRN</th>
      <th>PRN</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Confirmed By</th>
      <th>Confirmed At</th>
      <th>Payment Type</th>
      <th>UTR Number</th>
    </tr>
  </thead>
  <tbody>
    {% for ticket in tickets %}
    <tr>
      <td>{{ ticket.student.name }}</td>
      <td>{{ ticket.student.srn }}</td>
      <td>{{ ticket.student.prn }}</td>
      <td>{{ ticket.student.email }}</td>
      <td>{{ ticket.student.phone }}</td>
      <td>{{ ticket.confirmed_by.username }}</td>
      <td>{{ ticket.confirmed_at|date:"Y-m-d H:i" }}</td>
      <td>{{ ticket.payment_type }}</td>
      <td>{{ ticket.utr_number }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="9" class="text-center">No confirmed tickets found.</td></tr>
    {% endfor %}
  </tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
  document.getElementById('downloadPdfBtn').addEventListener('click', function () {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.autoTable({
      html: '.confirmed-tickets-table',   // Use the new class here
      startY: 20,
      theme: 'striped',
      headStyles: { fillColor: [0, 123, 255] },  // Bootstrap primary blue
      styles: { fontSize: 8 },
      margin: { top: 30 },
      didDrawPage: function (data) {
        doc.text('Confirmed Tickets List', data.settings.margin.left, 10);
      }
    });

    doc.save('confirmed-tickets-list.pdf');
  });
</script>



{% endblock %}
